<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tessellate</title>
    <link rel="stylesheet" href="tessellate_styles.css">
    <link rel="icon" type="image/png" href="assets/tessellate_icon.png">
</head>
<body>
    <header>
        <h1>Tessellate</h1>
    </header>

    <div class="game-status">
        <div id="score-display">
            <span class="red-text">Red: 1</span> | <span class="blue-text">Blue: 1</span>
        </div>
        <div id="turn-indicator">Current Turn: <span class="red-text">Red</span></div>
    </div>

    <div id="game-container">
        <canvas id="game-board"></canvas>
    </div>

    <aside id="ai-sidebar" class="ai-sidebar" aria-live="polite" style="display:none;">
        <div class="sidebar-panel">
            <div class="sidebar-title">Agent's Thinking</div>
            <div id="ai-explanation" class="ai-explanation" style="display:none;"></div>
        </div>
    </aside>

    <div class="rules" id="rules-panel">
         <p>1. A <strong>turn</strong> consists of a player placing a tile with their color on the board.</p>
         <p>2. A <strong>tile</strong> is a right triangle that fills one half of a square on the board.</p>
         <p>3. A <strong>valid tile placement</strong> does not overlap with any tiles on the board. Thus if a square is empty, there are four ways to place a tile in it. But if a square already has one tile in it, there is only one valid way to fill it. In other words, choosing a corner of a square to place your tile in prevents you and your opponent from using the two adjacent corners in that square.</p>
         <p>4. An <strong>island</strong> is formed by any number of tiles of the same color connected by a full edge.</p>
         <p>5. The <strong>size of an island</strong> is the number of tiles in it.</p>
         <p>6. A <strong>player's score</strong> is the product of all their islands (the multiplication of their islands' sizes).</p>
         <p>7. The <strong>end of the game</strong> is when all the squares are filled and no more tiles can be placed.</p>
         <p>8. The <strong>winner</strong> is the player with the highest score at the end of the game.</p>
     </div>

    <div id="controls">
        <button id="new-game-btn">New Game</button>
        <button id="rules-btn">Rules</button>
        <button id="browser-btn" onclick="window.location.href='browser.html'">Game Browser</button>
        <div style="margin-top:10px">
            <label style="margin-right:8px"><input type="checkbox" id="ai-enabled"> Play vs Agent</label>
            <label style="margin-right:8px">AI Side:
                <select id="ai-side">
                    <option value="BLUE" selected>Blue</option>
                    <option value="RED">Red</option>
                </select>
            </label>
            <label>Agent URL:
                <input id="agent-url" type="text" size="28" placeholder="Leave blank to use in-browser model" value="https://tessellate-app-ytnku.ondigitalocean.app">
            </label>
        </div>
    </div>

    <footer>
        Â© 2025 Max Cembalest
    </footer>
    <script src="pqn_inference.js"></script>
    <script src="game-pvp.js"></script>
    <script>
    (function() {
        function updateAISidebarVisibility() {
            var checkbox = document.getElementById('ai-enabled');
            var sidebar = document.getElementById('ai-sidebar');
            if (!checkbox || !sidebar) return;
            sidebar.style.display = checkbox.checked ? '' : 'none';
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', updateAISidebarVisibility);
        } else {
            updateAISidebarVisibility();
        }

        document.addEventListener('change', function(e) {
            if (e.target && e.target.id === 'ai-enabled') {
                updateAISidebarVisibility();
            }
        });
    })();
    </script>
</body>
</html>